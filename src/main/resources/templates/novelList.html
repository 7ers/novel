<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head lang="zh">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script type="text/javascript" src="/js/jquery-3.3.1.slim.min.js"></script>
    <link rel="stylesheet" href="/css/common.css"/>
    <link rel="stylesheet" href="/css/novelList.css"/>
</head>
<body onload="document.getElementById('content').style.display = 'block'">
<div id="content" style="display: none;">
    <div class="header">
        <span th:text="${categoryName}"></span>
        <a class="back" href="javascript:history.back(-1);">
            <svg id="" viewBox="0 0 1024 1024" width="100%" height="100%">
                <title>chevron-left-circle</title>
                <path class="path1" d="M142.462 193.664c91.869-91.869 214.016-142.464 343.938-142.464s252.067 50.595 343.936 142.464 142.464 214.014 142.464 343.936-50.595 252.069-142.464 343.938-214.014 142.462-343.936 142.462-252.069-50.594-343.938-142.462-142.462-214.016-142.462-343.938 50.594-252.067 142.462-343.936zM486.4 972.8c239.97 0 435.2-195.23 435.2-435.2s-195.23-435.2-435.2-435.2c-239.97 0-435.2 195.23-435.2 435.2s195.23 435.2 435.2 435.2z"></path>
                <path class="path2" d="M563.2 819.2c6.552 0 13.102-2.499 18.102-7.499 9.997-9.997 9.997-26.206 0-36.203l-237.898-237.898 237.898-237.898c9.997-9.998 9.997-26.206 0-36.205-9.998-9.997-26.206-9.997-36.205 0l-256 256c-9.998 9.997-9.998 26.206 0 36.203l256 256c5 5 11.55 7.499 18.102 7.499z"></path>
            </svg>
        </a>
        <a class="home" href="/index">
            <svg id="" viewBox="0 0 1024 1024" width="100%" height="100%">
                <title>home</title>
                <path class="path1" d="M1017.382 622.826l-452.050-499.634c-14.051-15.533-32.992-24.086-53.333-24.086-0.002 0 0 0 0 0-20.339 0-39.282 8.555-53.334 24.086l-452.050 499.634c-9.485 10.485-8.675 26.674 1.808 36.158 4.899 4.432 11.043 6.616 17.168 6.616 6.982 0 13.938-2.838 18.992-8.426l109.016-120.491v410.517c0 42.347 34.453 76.8 76.8 76.8h563.2c42.347 0 76.8-34.453 76.8-76.8v-410.517l109.018 120.493c9.485 10.483 25.674 11.296 36.158 1.808 10.483-9.485 11.293-25.675 1.806-36.158zM614.4 972.8h-204.8v-230.4c0-14.115 11.485-25.6 25.6-25.6h153.6c14.115 0 25.6 11.485 25.6 25.6v230.4zM819.2 947.2c0 14.115-11.485 25.6-25.6 25.6h-128v-230.4c0-42.349-34.451-76.8-76.8-76.8h-153.6c-42.347 0-76.8 34.451-76.8 76.8v230.4h-128c-14.115 0-25.6-11.485-25.6-25.6v-467.106l291.832-322.552c4.222-4.667 9.68-7.237 15.368-7.237s11.146 2.57 15.366 7.235l291.834 322.552v467.107z"></path>
            </svg>
        </a>
    </div>

    <form class="searchForm" method="post" action="">
        <input type="text" name="keyword" class="searchForm_input" placeholder="输入书名或作者">
        <input type="submit" class="searchForm_btn" value="">
    </form>

    <div id="novelListBox" th:each="novel, novelStat : ${novels}">
        <div class="container clearfix" onclick="location.href='novelInfo?nid=0'">
            <div class="left-wrapper">
                <div class="left">
                    <div style="width: 100%; height: 100%;">
                        <div>标题</div>
                        <div style="color: #888;">简介</div>
                    </div>
                </div>
            </div>
            <img class="right" th:src="${novel.icon}" />
        </div>
        <div class="line"></div>
    </div>

    <div class="loadMore" id="loadMore" >
        <div class="loadingBox">
<!--            <img class="loading" src="../../../images/client/loading.gif" style="display: <c:out value='${hasMore eq 1? "display": "none"}'/>;"/>-->
<!--            <div class="loadingText">${hasMore eq 1? "正在加载":"没有更多了"}</div>-->
        </div>
    </div>
</div>
</body>
<script type="text/javascript">
    let loadFlag = true; //false;
    $(function(){
        $(window).scroll(function(){
            if(loadFlag){
                return;
            }

            let totalHeight = parseFloat($(window).height()) + parseFloat($(window).scrollTop());
            let offset = $('#loadMore').height();

            if (/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)) {
                offset += 90;
            }

            if(totalHeight >= $(document).height() - offset){
                loadFlag = true;

                $.ajax({
                    url: 'fictionListData',
                    type: 'post',
                    data: {
                        page : 1,
                        category : 0
                    },
                    dataType: 'json',
                    cached: false,
                    success: function(data) {
                        for (let i = 0; i < data.fictions.length; i++) {
                            $('#fictionListBox').append('<div class="container clearfix" onclick="location.href=\'fictionInfo?fid=1\'">'
                                + '<div class="left-wrapper">'
                                + '<div class="left">'
                                + '<div style="width: 100%; height: 100%;">'
                                + '<div>标题</div>'
                                + '<div style="color: #888;">简介</div>'
                                + '</div></div></div>'
                                + '<img class="right" src=' + data.fictions[i].icon + ' />'
                                + '</div>'
                                + '<div class="line"></div>'
                            );
                        }

                        loadFlag = false;
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        loadFlag = false;
                    }
                });
            }
        });
    });
</script>
</html>